{% extends 'app/base.html' %}
{% load static %}
{% load display_name %}


{% block content %}
{% block styles %}
  <link rel="stylesheet" href="{% static 'forum/styles/post_list.css' %}">
  <link rel="stylesheet" href="{% static 'forum/styles/new_post_button.css' %}">
{% endblock %}

  <title>{% block title %}Channels | CIO Leaders{% endblock %}</title>

  <a href="{% url 'forum:post_create' %}" class="new-post-btn">
    <svg viewBox="0 0 24 24"><path d="M12 5v14m7-7H5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>
    New Post
  </a>
  <div class="forum-grid">
  {% for post in posts %}
    <div class="forum-card">
      <div class="forum-card-body">
        <h3 class="form-card-title">{{ post.title }}</h3>
        <h5 class="forum-card-user">
            {% if request.user == post.author %}
              {{ post.author|get_display_name }}
            {% else %}
              <a href="{% url 'users:profile' username=post.author.username %}">
                {{ post.author|get_display_name }}
              </a>
            {% endif %}
        </h5>
        <a href="{% url 'forum:post_detail' post.id %}?next={{ request.path }}">View</a>
      </div>
      <div class="forum-image-container">
        {% if post.images.all %}
          <img src="{{ post.images.all.0.image.url }}" alt="Post image" class="forum-img">
        {% elif post.image %}
          <img src="{{ post.image.url }}" alt="Post image" class="forum-img">
        {% endif %}
      </div>
    </div>
  {% empty %}
    <p>No posts yet.</p>
  {% endfor %}
  </div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('sidebar');
    const newPostBtn = document.querySelector('.new-post-btn');
    
    if (sidebar && newPostBtn) {
      // Get the sidebar width
      function getSidebarWidth() {
        const computed = window.getComputedStyle(sidebar);
        const width = computed.width;
        return parseInt(width) || 0;
      }
      
      // Update button position
      function updateButtonPosition() {
        if (sidebar.classList.contains('active')) {
          const sidebarWidth = getSidebarWidth();
          const newLeft = 32 + sidebarWidth;
          newPostBtn.style.left = newLeft + 'px';
        } else {
          newPostBtn.style.left = '32px';
        }
      }
      
      // Use MutationObserver to watch for class changes on sidebar
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.attributeName === 'class') {
            updateButtonPosition();
          }
        });
      });
      
      observer.observe(sidebar, { attributes: true, attributeFilter: ['class'] });
      
      // Initial position
      updateButtonPosition();
    }
  });
</script>
{% endblock %}
