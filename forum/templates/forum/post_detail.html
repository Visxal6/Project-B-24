{% extends 'app/base.html' %}
{% load static %}


{% block styles %}
  <link rel="stylesheet" href="{% static 'forum/styles/post_detail.css' %}">
  <link rel="stylesheet" href="{% static 'forum/styles/post_detail_actions.css' %}">
{% endblock %}

<title>{% block title %}Channels | Post Details{% endblock %}</title>

{% block content %}
  {% url 'forum:post_list' as default_url %}

  <div class="container">
    <div class="card">
      <div style="display: flex; gap: 12px; margin-bottom: 1rem; align-items: center;">
        <a href="{{ request.GET.next|default:default_url }}" class="btn btn-secondary post-action-btn">Back</a>
          {% if user.is_authenticated and user == post.author %}
            <form action="{% url 'forum:post_delete' post.pk %}" method="post" style="display:inline; margin: 0;">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger post-action-btn" onclick="return confirm('Are you sure you want to delete this post?');">Delete Post</button>
            </form>
          {% endif %}
      </div>

      <div class="card-body">
        <h3 class="card-title">{{ post.title }}</h3>
        <h5 class="card-user">{{ post.author.username }}</h5>
        <p class="card-timestamp">Posted {{ post.created_at }}</p>
        <p class="card-text">{{ post.caption }}</p>
      </div>
      {% if post.image %}
        <img src="{{ post.image.url }}" class="post-detail-img" alt="Post image">
      {% endif %}
    
    </div>

    <div class="comment-container">
      <h2>Comments</h2>

      {% if user.is_authenticated %}
        <form method="post">
            {% csrf_token %}
            {{ form.content }}
            <input type="hidden" name="parent_id" value="">
            <button type="submit">Add Comment</button>
        </form>
      {% else %}
          <p><a href="{% url 'login' %}">Log in</a> to add a comment.</p>
      {% endif %}

      {% for comment in comments %}
        {% include 'forum/comment.html' with comment=comment %}
      {% empty %}
        <p>No comments yet. Be the first to comment!</p>
      {% endfor %}
    </div>
  </div>
{% endblock %}
